== Creating new services
This chapter details how you can use MSDL to develop new services that can be used over the Maritime Messaging Service.
At the moment we require usage of Apache Maven to generate Java stubs from MSDL files. But in the future we aim to provide a standalone compiler.

=== Example
The following example will use a single pom.xml file, a MSDL file and two Java files.
The files created should follow this layout.

image::{imagesdir}/chapter7-4files.png[projectlayout]

The example is taken from https://github.com/MaritimeCloud/Documentation/tree/master/developer-guide/maven-examples
which you can clone instead of typing it out yourself.

==== pom.xml
In order to use create the Java stubs using the MSDL compiler. You need to enable the MSDL maven plugin in your pom.xml file.
Here is an example of pom.xml that can be used as the basis. Notice the MDSL build plugin.
[source,xml,subs="+attributes"]
----
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>
  
  <groupId>your.group-id</groupId>
  <artifactId>your.artifact.id</artifactId>
  <version>123</version>
  
  <build>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-compiler-plugin</artifactId>
        <version>3.1</version>
        <configuration>
          <source>1.8</source>
          <target>1.8</target>
          <encoding>UTF-8</encoding>
          <optimize>false</optimize>
          <debug>true</debug>
          <showDeprecation>true</showDeprecation>
        </configuration>
      </plugin>
      <plugin>
        <groupId>net.maritimecloud.msdl</groupId>
        <artifactId>mc-msdl-maven-plugin</artifactId>
        <version>{version}</version>
        <executions>
          <execution>
            <goals>
              <goal>compile</goal>
            </goals>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build>
  
  <dependencies>
    <dependency>
      <groupId>net.maritimecloud.mms</groupId>
      <artifactId>mc-mms-client-impl</artifactId>
      <version>{version}</version>
    </dependency>
  </dependencies>
</project>
----

==== MSDL file
All MSDL files must be place in the _src/main/msdl_ folder. Furthermore more they must be ordered by their namespace.
For example, a MSDL file with a namespace 'org.acme' should be place in the _src/main/msdl/org/acme* folder_

Save this MSDL as _src/main/msdl/maritimecloud/examples/examples.msdl_

----
namespace maritimecloud.examples;

endpoint MathEndpoint {
  int sum(1:int left, 2:int right);
}

broadcast Hello {
  1: text msg;
}

endpoint ImageRender {
  binary render(1:text str);
}
----

==== Java files
Before we generate the stubs let us add two classes that uses the stubs we generate

A client with a random Maritime ID that repeatable sends broadcasts:

[source,java]
----
include::{sourcedir2}/net/maritimecloud/example/SendBroadcast.java[]
----

And a client that repeatable receives the broadcasts:

[source,java]
----
include::{sourcedir2}/net/maritimecloud/example/ReceiveBroadcast.java[]
----

=== Running and building the examples

You can generate the Java stubs by using the usual maven targets such as 'compile', 'package' and 'install'.
Generation of sources is attached to Maven's 'generate-sources' lifecycle as specified in http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html

----
> mvn package
----

If you inspect the output of the build you will see the following 5 generated java files.

image::{imagesdir}/chapter7-generated.png[projectlayout]

Since 'mvn package' also compiles your source code you can start the examples from the the command line.
Here we are using Maven's 'exec' plugin which makes it easy to put your dependencies on the classpath.
 
Start the client that broadcasts simple messages by using

----
> mvn exec:java -Dexec.mainClass="net.maritimecloud.example.SendBroadcast"
----

And a client that receives the broadcasts by using

----
> mvn exec:java -Dexec.mainClass="net.maritimecloud.example.ReceiveBroadcast"
----

You can put the jar file that you have just generated on the classpath in any project.
And use the stubs that was generated. This make it easy to have a single project that contains
all MSDL files and generated stubs. And the multiple projects that all references that project.

By following chapter 3 it should be easy to register your own endpoints as well.


